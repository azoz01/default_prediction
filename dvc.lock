schema: '2.0'
stages:
  split_data:
    cmd: python pipelines/bin/split_data.py
    deps:
    - path: pipelines/bin/split_data.py
      md5: cb32cccd9a38866eae0df20bba41e761
      size: 1669
    - path: resources/data/raw
      md5: d7b249e098f4dc55aae557e066c9563c.dir
      size: 85166965
      nfiles: 7
    - path: utils
      md5: ff0de2452a35552dee6e5579014db15a.dir
      size: 11684
      nfiles: 10
    params:
      params.yaml:
        split_data.random_state: 42
        split_data.test_size: 0.15
        split_data.valid_size: 0.15
    outs:
    - path: resources/data/splitted
      md5: 5d03e4c07c60e4880b2495e45b998e3a.dir
      size: 28128421
      nfiles: 6
  clean:
    cmd: python pipelines/bin/clean_data.py
    deps:
    - path: pipelines/bin/clean_data.py
      md5: 76b6878728ea6d5df0b257a0e8987fb8
      size: 978
    - path: resources/data/splitted
      md5: 5d03e4c07c60e4880b2495e45b998e3a.dir
      size: 28128421
      nfiles: 6
    - path: utils
      md5: ff0de2452a35552dee6e5579014db15a.dir
      size: 11684
      nfiles: 10
    outs:
    - path: resources/data/clean
      md5: 5425727cca4f8ea4a9b85d54185221e9.dir
      size: 23328273
      nfiles: 6
    - path: resources/pipelines/serialized/data_cleaner.pkl
      md5: 0be635819344a82abf81ca274bb1e3cd
      size: 8709
  transform_numerical_columns:
    cmd: python pipelines/bin/transform_numerical_columns.py
    deps:
    - path: pipelines/bin/transform_numerical_columns.py
      md5: ab662b74f647412eedbe65dbb374cbec
      size: 1057
    - path: resources/data/clean
      md5: 5425727cca4f8ea4a9b85d54185221e9.dir
      size: 23328273
      nfiles: 6
    - path: utils
      md5: ff0de2452a35552dee6e5579014db15a.dir
      size: 11684
      nfiles: 10
    outs:
    - path: resources/data/transformed_numerical_columns
      md5: 61b61818d3028e44ceda96f87a277741.dir
      size: 22019960
      nfiles: 6
    - path: resources/pipelines/serialized/numerical_columns_transformer.pkl
      md5: b2f0cfe696543ee1ccbcd2a291a4650b
      size: 7157
  balance_data:
    cmd: python pipelines/bin/balance_data.py
    deps:
    - path: pipelines/bin/balance_data.py
      md5: 11cd918a9a81e02614fe1ec9739a8fe7
      size: 1435
    - path: pipelines/lib/data_balance
      md5: 0546e3ab6514186c1cb1b5f2e3e7dc3d.dir
      size: 1688
      nfiles: 4
    - path: resources/data/transformed_numerical_columns
      md5: 61b61818d3028e44ceda96f87a277741.dir
      size: 22019960
      nfiles: 6
    - path: utils
      md5: ff0de2452a35552dee6e5579014db15a.dir
      size: 11684
      nfiles: 10
    params:
      params.yaml:
        balance_data.method: passthrough
    outs:
    - path: resources/data/balanced
      md5: 61b61818d3028e44ceda96f87a277741.dir
      size: 22019960
      nfiles: 6
  transform_categorical_columns:
    cmd: python pipelines/bin/transform_categorical_columns.py
    deps:
    - path: pipelines/bin/transform_categorical_columns.py
      md5: f94c9d9e2013b224059802aff7d1e61a
      size: 1914
    - path: resources/data/balanced
      md5: 61b61818d3028e44ceda96f87a277741.dir
      size: 22019960
      nfiles: 6
    - path: utils
      md5: ff0de2452a35552dee6e5579014db15a.dir
      size: 11684
      nfiles: 10
    params:
      params.yaml:
        category_embedding:
          embedder_n_epochs: 5
          embedder_num_layers: 2
        transform_categorical_columns.method: one_hot
    outs:
    - path: resources/data/categorical_transformed
      md5: 1e6cf58c5a7726caafbaacc46f8f5928.dir
      size: 24044788
      nfiles: 6
    - path: resources/pipelines/serialized/categorical_columns_transformer.pkl
      md5: 06790500bd7a1ba026411e8d1b5027e6
      size: 8795
  reduce_data:
    cmd: python pipelines/bin/reduce_data.py
    deps:
    - path: pipelines/bin/reduce_data.py
      md5: 5bedf21e79cd890e9ea357d58d00c2af
      size: 1549
    - path: resources/data/categorical_transformed
      md5: 1e6cf58c5a7726caafbaacc46f8f5928.dir
      size: 24044788
      nfiles: 6
    - path: utils
      md5: ff0de2452a35552dee6e5579014db15a.dir
      size: 11684
      nfiles: 10
    params:
      params.yaml:
        frufs:
          output_n_cols: 200
        reduce_data.method: rfe
        rfe:
          output_n_cols: 200
    outs:
    - path: resources/data/reduced
      md5: 5b52a4f97ab995c9b57e2be47de7aa63.dir
      size: 23159422
      nfiles: 6
    - path: resources/pipelines/serialized/data_reductor.pkl
      md5: b94ee0fdc4afbb4d24bab06382c5618f
      size: 85331
  train_model:
    cmd: python models/bin/train_model.py
    deps:
    - path: models/bin/train_model.py
      md5: b19249ce200aa6246b7c5bd6870576b8
      size: 2991
    - path: resources/models/studies/xgboost/xgboost-2022-10-20-22_10_35.db
      md5: caeddadf9b8b258a11a49ee66e1d8543
      size: 995328
    - path: utils
      md5: ff0de2452a35552dee6e5579014db15a.dir
      size: 11684
      nfiles: 10
    params:
      params.yaml:
        train_model:
          study_input_path: resources/models/studies/xgboost/xgboost-2022-10-20-22_10_35.db
          model_name: xgboost
          model_difference_threshold: 0.02
          model_class: xgboost
          data_path: reduced
    outs:
    - path: resources/models/parameters/xgboost.json
      md5: f4af700615c2abb682f106c3b9b528f9
      size: 1093
    - path: resources/models/serialized/xgboost.pkl
      md5: e8d06afb6c50a1fa9a0907861a1d05c3
      size: 150368
  calibrate_model:
    cmd: python models/bin/calibrate_model.py
    deps:
    - path: models/bin/calibrate_model.py
      md5: ee409a1c6e3b0c5a06781805e2d6c6b5
      size: 1152
    - path: resources/models/serialized/xgboost.pkl
      md5: e8d06afb6c50a1fa9a0907861a1d05c3
      size: 150368
    - path: utils
      md5: ff0de2452a35552dee6e5579014db15a.dir
      size: 11684
      nfiles: 10
    params:
      params.yaml:
        calibrate_model:
          model_input_path: resources/models/serialized/xgboost.pkl
          data_path: reduced
          model_output_path: resources/models/serialized/xgboost_calibrated.pkl
          calibration_method: isotonic
    outs:
    - path: resources/models/serialized/xgboost_calibrated.pkl
      md5: 6a1cb3851186e5a59275016f7314710e
      size: 183888
