schema: '2.0'
stages:
  split_data:
    cmd: python pipelines/bin/split_data.py
    deps:
    - path: pipelines/bin/split_data.py
      md5: 147d98da589e277d5e079c30a47b0a1a
      size: 1936
    - path: resources/data/raw
      md5: d7b249e098f4dc55aae557e066c9563c.dir
      size: 85166965
      nfiles: 7
    - path: utils
      md5: 1a055da60c29f0ea270f85b68c553955.dir
      size: 13741
      nfiles: 8
    params:
      params.yaml:
        split_data.random_state: 42
        split_data.test_size: 0.15
        split_data.valid_size: 0.15
    outs:
    - path: resources/data/splitted
      md5: 66957dd1526592edabb9dff07ef2d723.dir
      size: 24240491
      nfiles: 6
  transform_numerical_columns:
    cmd: python preprocessing/bin/transform_numerical_columns.py
    deps:
    - path: preprocessing/bin/transform_numerical_columns.py
      md5: 1d14fe81fff5fa9690f9fcfa31b943ca
      size: 1237
    - path: preprocessing/lib/numerical/numerical_columns_preprocessing.py
      md5: 74260256c86b3dc0b7510d730947d364
      size: 3855
    - path: resources/data/clean
      md5: c99dec8c6cf143cd0a23231aa56ff0a1.dir
      size: 7268839
      nfiles: 6
    - path: utils
      md5: a1a1634a47696b255c4a3b5f5ff43efe.dir
      size: 27389
      nfiles: 13
    params:
      params.yaml:
        transform_numerical_columns:
          remove_skewness: true
          scale: true
    outs:
    - path: resources/data/transformed_numerical_columns
      md5: 96575405cab103757e45a579ba0c50d8.dir
      size: 7759337
      nfiles: 6
    - path: resources/preprocessing/serialized/numerical_columns_transformer.pkl
      md5: 94d54f8c959266c6ccfedff44ceaef58
      size: 2831
  balance_data:
    cmd: python pipelines/bin/balance_data.py
    deps:
    - path: pipelines/bin/balance_data.py
      md5: af7cb5ae1f0709e316eb084fa6c636d9
      size: 1509
    - path: pipelines/lib/data_balance
      md5: 57c8b054f5f1d47df6780a7cfafa123a.dir
      size: 1688
      nfiles: 4
    - path: resources/data/transformed_numerical_columns
      md5: a9c594c0a5d4ad42fbde512747ce9666.dir
      size: 27881995
      nfiles: 6
    - path: utils
      md5: 1a055da60c29f0ea270f85b68c553955.dir
      size: 13741
      nfiles: 8
    params:
      params.yaml:
        balance_data.method: oversample
    outs:
    - path: resources/data/balanced
      md5: f9be8659cbc182cae8b14194f50f06d3.dir
      size: 41424376
      nfiles: 6
  transform_categorical_columns:
    cmd: python preprocessing/bin/transform_categorical_columns.py
    deps:
    - path: preprocessing/bin/transform_categorical_columns.py
      md5: 8f137d9cd9bd8541d4cad7cb9f9af0fb
      size: 1544
    - path: preprocessing/lib/categorical
      md5: c8776069a658677017b72b8ac43d622a.dir
      size: 22213
      nfiles: 6
    - path: resources/data/balanced
      md5: 71ecf4d4e8b17b7027698ef2f3dfeff9.dir
      size: 29324168
      nfiles: 6
    - path: utils
      md5: a1a1634a47696b255c4a3b5f5ff43efe.dir
      size: 27389
      nfiles: 13
    params:
      params.yaml:
        category_embedding:
          embedder_n_epochs: 4
          embedder_num_layers: 2
        transform_categorical_columns:
          method: one_hot
    outs:
    - path: resources/data/transformed_categorical_column
      md5: b0e53ecf38af0be86a808c99d74a4ec0.dir
      size: 8036525
      nfiles: 6
    - path: resources/preprocessing/serialized/categorical_columns_transformer.pkl
      md5: 53bb287a18d673381af7a3cd2768bbfc
      size: 1875
  reduce_data:
    cmd: python pipelines/bin/reduce_data.py
    deps:
    - path: pipelines/bin/reduce_data.py
      md5: b9132d976f34ce9e4f06b585655598d2
      size: 1643
    - path: resources/data/categorical_transformed
      md5: add40e5bbb39e9643b75e1a8c21419d5.dir
      size: 30253882
      nfiles: 6
    - path: utils
      md5: 1a055da60c29f0ea270f85b68c553955.dir
      size: 13741
      nfiles: 8
    params:
      params.yaml:
        frufs:
          output_n_cols: 200
        reduce_data.method: rfe
        rfe:
          output_n_cols: 200
    outs:
    - path: resources/data/reduced
      md5: 2fe640fb0d3328d7943805f53de79590.dir
      size: 29314002
      nfiles: 6
    - path: resources/pipelines/serialized/data_reductor.pkl
      md5: 3bc91848d026825faf42bc864cb62fc4
      size: 99158
  train_model:
    cmd: python models/bin/training/train_xgboost.py
    deps:
    - path: models/bin/training/train_xgboost.py
      md5: 46d803c664e6a40845dd6f579474bc6c
      size: 2210
    - path: resources/data/reduced
      md5: b0e53ecf38af0be86a808c99d74a4ec0.dir
      size: 8036525
      nfiles: 6
    - path: utils
      md5: a1a1634a47696b255c4a3b5f5ff43efe.dir
      size: 27389
      nfiles: 13
    params:
      params.yaml:
        train_model:
          train_model_script_path: models/bin/training/train_xgboost.py
          out_model_serialized_path: resources/models/serialized/xgboost.pkl
    outs:
    - path: resources/models/serialized/xgboost.pkl
      md5: 30c17a68603bcee6247b0fcc40f84dd9
      size: 860617
  calibrate_model:
    cmd: python models/bin/utils/calibrate_model.py
    deps:
    - path: models/bin/utils/calibrate_model.py
      md5: b70160e58c14ca25359c209645cf11d4
      size: 1077
    - path: resources/models/serialized/xgboost.pkl
      md5: 30c17a68603bcee6247b0fcc40f84dd9
      size: 860617
    - path: utils
      md5: a1a1634a47696b255c4a3b5f5ff43efe.dir
      size: 27389
      nfiles: 13
    params:
      params.yaml:
        calibrate_model:
          data_path: reduced
          calibration_method: isotonic
          model_input_path: resources/models/serialized/xgboost.pkl
          model_output_path: resources/models/serialized/xgboost_calibrated.pkl
    outs:
    - path: resources/models/serialized/xgboost_calibrated.pkl
      md5: bf38d1da3215c366e4456e40d627b8ac
      size: 867221
  train_gaussian_nb:
    cmd: python models/custom_train/train_gaussian_nb.py
    deps:
    - path: models/custom_train/train_gaussian_nb.py
      md5: 1a36d2b8df8c5d431c31f4ce6bb6618e
      size: 1360
    - path: utils
      md5: 1a055da60c29f0ea270f85b68c553955.dir
      size: 13741
      nfiles: 8
    outs:
    - path: resources/models/serialized/gaussian_nb.pkl
      md5: d63f72c02e987f63d1ac185013ec8cff
      size: 11990
  train_lda:
    cmd: python models/custom_train/train_lda.py
    deps:
    - path: models/custom_train/train_lda.py
      md5: 94cd11bc12ab1790b849e9e077c69df5
      size: 1412
    - path: utils
      md5: 1a055da60c29f0ea270f85b68c553955.dir
      size: 13741
      nfiles: 8
    outs:
    - path: resources/models/serialized/lda.pkl
      md5: 4e0c99bedc1d3b77460d4953750fb542
      size: 13833
  train_neural_network:
    cmd: python models/custom_train/train_neural_network.py
    deps:
    - path: models/custom_train/train_neural_network.py
      md5: 4ab95308d6002a15879f5a7828e89b8c
      size: 1108
    - path: utils
      md5: 1a055da60c29f0ea270f85b68c553955.dir
      size: 13741
      nfiles: 8
    outs:
    - path: resources/models/serialized/neural_network.pkl
      md5: 359f07796ed18ac9fcf6b0716e993f08
      size: 5312168
  initial_preprocessing:
    cmd: python preprocessing/bin/initial_preprocessing.py
    deps:
    - path: preprocessing/bin/initial_preprocessing.py
      md5: a347d3a369010f70080db54b048c0958
      size: 1365
    - path: preprocessing/lib/cleaning/initial_preprocessing.py
      md5: f460d0a11dc44ecb7d87be5a70fa8755
      size: 5189
    - path: resources/data/raw
      md5: 9c35c8314770c5244ad0916ed9ade585.dir
      size: 100353486
      nfiles: 3
    - path: utils
      md5: a1a1634a47696b255c4a3b5f5ff43efe.dir
      size: 27389
      nfiles: 13
    outs:
    - path: resources/data/initially_preprocessed/loan.parquet
      md5: ec343e6532a8ed92a76b0ff071087634
      size: 13022008
    - path: resources/preprocessing/serialized/initial_preprocessor.pkl
      md5: 2c9dca5ae449e15b55d5eb192cdf38da
      size: 1106
  split:
    cmd: python preprocessing/bin/split.py
    deps:
    - path: preprocessing/bin/split.py
      md5: 660aeeef35a4b253e63393d57b9c746a
      size: 1639
    - path: resources/data/initially_preprocessed
      md5: bcdfe43f129060a028e61813737a9403.dir
      size: 13022008
      nfiles: 1
    - path: utils
      md5: a1a1634a47696b255c4a3b5f5ff43efe.dir
      size: 27389
      nfiles: 13
    params:
      params.yaml:
        split_data:
          random_state: 42
          test_size: 0.15
          valid_size: 0.15
    outs:
    - path: resources/data/splitted
      md5: 07e53c12b250c946ad0d09ce80965651.dir
      size: 11246224
      nfiles: 6
  impute:
    cmd: python preprocessing/bin/impute.py
    deps:
    - path: preprocessing/bin/impute.py
      md5: 509cfd920f1f1babefde3b67452fac60
      size: 1194
    - path: preprocessing/lib/cleaning/imputation.py
      md5: cf4eb5b0e72c384aa133b87bef9db0e0
      size: 4259
    - path: resources/data/splitted
      md5: 07e53c12b250c946ad0d09ce80965651.dir
      size: 11246224
      nfiles: 6
    - path: utils
      md5: a1a1634a47696b255c4a3b5f5ff43efe.dir
      size: 27389
      nfiles: 13
    outs:
    - path: resources/data/clean
      md5: c99dec8c6cf143cd0a23231aa56ff0a1.dir
      size: 7268839
      nfiles: 6
    - path: resources/preprocessing/serialized/imputer.pkl
      md5: 4e21a09f98e222dad147edb1be68ccb7
      size: 50536831
  balance:
    cmd: python preprocessing/bin/balance.py
    deps:
    - path: preprocessing/bin/balance.py
      md5: 3ab2dba2307d2daf32e80fddace2f59c
      size: 1061
    - path: preprocessing/lib/balance_data
      md5: 3f6f0a1e18e3ff9f33830c84e1d2460f.dir
      size: 2090
      nfiles: 4
    - path: resources/data/transformed_numerical_columns
      md5: 96575405cab103757e45a579ba0c50d8.dir
      size: 7759337
      nfiles: 6
    - path: utils
      md5: a1a1634a47696b255c4a3b5f5ff43efe.dir
      size: 27389
      nfiles: 13
    params:
      params.yaml:
        balance_data:
          method: smotenc
    outs:
    - path: resources/data/balanced
      md5: 71ecf4d4e8b17b7027698ef2f3dfeff9.dir
      size: 29324168
      nfiles: 6
  reduce:
    cmd: python preprocessing/bin/reduce.py
    deps:
    - path: preprocessing/bin/reduce.py
      md5: 12ea381f6ee8bee2d682483afcd3a0d2
      size: 1172
    - path: preprocessing/lib/feature_selection
      md5: 48dbb4b6d99a9490ed5e72e862ff322c.dir
      size: 4536
      nfiles: 6
    - path: resources/data/transformed_categorical_column
      md5: b0e53ecf38af0be86a808c99d74a4ec0.dir
      size: 8036525
      nfiles: 6
    - path: utils
      md5: a1a1634a47696b255c4a3b5f5ff43efe.dir
      size: 27389
      nfiles: 13
    params:
      params.yaml:
        frufs:
          output_n_cols: 50
        reduce_data.method: passthrough
        rfe:
          output_n_cols: 50
    outs:
    - path: resources/data/reduced
      md5: b0e53ecf38af0be86a808c99d74a4ec0.dir
      size: 8036525
      nfiles: 6
    - path: resources/preprocessing/serialized/data_reductor.pkl
      md5: ca5b50800024b47907494dd7718eae58
      size: 59
  build_final_model:
    cmd: python models/bin/utils/build_final_model.py
    deps:
    - path: models/bin/utils/build_final_model.py
      md5: 1277b1448710bce59b61a152f4112a54
      size: 1026
    - path: resources/models/serialized/xgboost_calibrated.pkl
      md5: bf38d1da3215c366e4456e40d627b8ac
      size: 867221
    - path: resources/preprocessing/serialized
      md5: 40dfe3e8b843514c2ef0200d815dfb25.dir
      size: 50542702
      nfiles: 5
    - path: utils
      md5: a1a1634a47696b255c4a3b5f5ff43efe.dir
      size: 27389
      nfiles: 13
    params:
      params.yaml:
        build_final_model:
          pipelines:
          - resources/preprocessing/serialized/initial_preprocessor.pkl
          - resources/preprocessing/serialized/imputer.pkl
          - resources/preprocessing/serialized/numerical_columns_transformer.pkl
          - resources/preprocessing/serialized/categorical_columns_transformer.pkl
          - resources/preprocessing/serialized/data_reductor.pkl
          model: resources/models/serialized/xgboost_calibrated.pkl
          output_path: resources/models/final/model.pkl
          publish_experiment_id: 3
    outs:
    - path: resources/models/final/model.pkl
      md5: fea4577a552d28e42702a79ec21e4b10
      size: 51410768
